{% extends "base.html" %} {% block title %}Reset Password - Todos App{% endblock
%} {% block meta_description %}Reset your Todos account password{% endblock %}
{% block extra_css %}
<style>
  .reset-password-container {
    min-height: 100vh;
    display: flex;
    align-items: center;
    justify-content: center;
    background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
    position: relative;
    padding: 2rem 0;
  }

  .reset-password-container::before {
    content: "";
    position: absolute;
    top: 0;
    left: 0;
    right: 0;
    bottom: 0;
    background: radial-gradient(
        circle at 20% 50%,
        rgba(255, 255, 255, 0.1) 0%,
        transparent 50%
      ),
      radial-gradient(
        circle at 80% 80%,
        rgba(255, 255, 255, 0.05) 0%,
        transparent 50%
      );
    pointer-events: none;
  }

  .reset-password-card {
    background: rgba(255, 255, 255, 0.95);
    backdrop-filter: blur(10px);
    border: 1px solid rgba(255, 255, 255, 0.18);
    border-radius: var(--border-radius);
    box-shadow: var(--card-shadow);
    width: 100%;
    max-width: 420px;
    padding: 2.5rem;
    position: relative;
    z-index: 1;
    animation: slideInUp 0.6s ease-out;
  }

  @keyframes slideInUp {
    from {
      opacity: 0;
      transform: translateY(30px);
    }
    to {
      opacity: 1;
      transform: translateY(0);
    }
  }

  .reset-password-header {
    text-align: center;
    margin-bottom: 2rem;
  }

  .reset-password-header .logo {
    font-size: 2.5rem;
    color: var(--primary-color);
    margin-bottom: 0.5rem;
  }

  .reset-password-header h1 {
    font-size: 1.75rem;
    font-weight: 700;
    color: #2d3748;
    margin-bottom: 0.5rem;
  }

  .reset-password-header p {
    color: #718096;
    font-size: 0.95rem;
  }

  .form-control {
    border: 2px solid #e2e8f0;
    border-radius: var(--border-radius);
    padding: 0.875rem 1rem;
    font-size: 0.95rem;
    transition: all 0.3s ease;
    background: #f7fafc;
  }

  .form-control:focus {
    border-color: var(--primary-color);
    background: white;
    box-shadow: 0 0 0 3px rgba(102, 126, 234, 0.1);
  }

  .form-label {
    font-weight: 600;
    color: #2d3748;
    margin-bottom: 0.5rem;
    font-size: 0.95rem;
  }

  .form-group {
    margin-bottom: 1.5rem;
  }

  .btn-reset {
    background: linear-gradient(
      135deg,
      var(--primary-color),
      var(--secondary-color)
    );
    border: none;
    border-radius: var(--border-radius);
    padding: 0.875rem 1.5rem;
    font-weight: 600;
    font-size: 1rem;
    color: white;
    width: 100%;
    transition: all 0.3s ease;
    cursor: pointer;
    box-shadow: 0 4px 15px rgba(102, 126, 234, 0.4);
  }

  .btn-reset:hover {
    transform: translateY(-2px);
    box-shadow: 0 6px 20px rgba(102, 126, 234, 0.6);
    color: white;
  }

  .btn-reset:active {
    transform: translateY(0);
  }

  .btn-reset:disabled {
    opacity: 0.6;
    cursor: not-allowed;
    transform: none;
  }

  .password-strength {
    margin-top: 0.5rem;
    padding: 0.75rem;
    border-radius: 0.5rem;
    font-size: 0.85rem;
    font-weight: 600;
  }

  .strength-weak {
    background: rgba(245, 101, 101, 0.1);
    color: var(--danger-color);
  }

  .strength-fair {
    background: rgba(237, 137, 54, 0.1);
    color: var(--warning-color);
  }

  .strength-good {
    background: rgba(72, 187, 120, 0.1);
    color: var(--success-color);
  }

  .alert {
    border-radius: var(--border-radius);
    border: none;
    padding: 1rem;
    margin-bottom: 1.5rem;
    animation: slideInDown 0.3s ease-out;
  }

  @keyframes slideInDown {
    from {
      opacity: 0;
      transform: translateY(-10px);
    }
    to {
      opacity: 1;
      transform: translateY(0);
    }
  }

  .alert-danger {
    background: #fef2f2;
    border-left: 4px solid var(--danger-color);
    color: #742a2a;
  }

  .alert-success {
    background: #f0fdf4;
    border-left: 4px solid var(--success-color);
    color: #15803d;
  }

  .auth-link {
    text-align: center;
    margin-top: 1.5rem;
    color: #718096;
    font-size: 0.95rem;
  }

  .auth-link a {
    color: var(--primary-color);
    text-decoration: none;
    font-weight: 600;
  }

  .auth-link a:hover {
    text-decoration: underline;
  }
</style>
{% endblock %} {% block content %}
<div class="reset-password-container">
  <div class="reset-password-card">
    <div class="reset-password-header">
      <div class="logo">
        <i class="bi bi-lock-fill"></i>
      </div>
      <h1>Create New Password</h1>
      <p>Enter a strong password to reset your account</p>
    </div>

    <div id="errorAlert"></div>
    <div id="successAlert"></div>

    <form id="resetPasswordForm">
      <div class="form-group">
        <label for="newPassword" class="form-label">
          <i class="bi bi-lock-fill"></i> New Password
        </label>
        <input
          type="password"
          class="form-control"
          id="newPassword"
          name="newPassword"
          placeholder="Enter a strong password"
          required
          minlength="8"
          autocomplete="new-password"
        />
        <div id="passwordStrength" class="password-strength"></div>
      </div>

      <div class="form-group">
        <label for="confirmPassword" class="form-label">
          <i class="bi bi-lock-check"></i> Confirm Password
        </label>
        <input
          type="password"
          class="form-control"
          id="confirmPassword"
          name="confirmPassword"
          placeholder="Confirm your new password"
          required
          autocomplete="new-password"
        />
      </div>

      <button type="submit" class="btn btn-reset" id="resetBtn">
        <i class="bi bi-check-circle"></i> Reset Password
      </button>
    </form>

    <div class="auth-link">
      Remember your password? <a href="/login">Sign in here</a>
    </div>
  </div>
</div>
{% endblock %} {% block extra_js %}
<script>
  document.addEventListener("DOMContentLoaded", function () {
    const resetPasswordForm = document.getElementById("resetPasswordForm");
    const resetBtn = document.getElementById("resetBtn");
    const errorAlert = document.getElementById("errorAlert");
    const successAlert = document.getElementById("successAlert");
    const newPasswordInput = document.getElementById("newPassword");

    // Get token from URL
    const urlParams = new URLSearchParams(window.location.search);
    const token = urlParams.get("token");

    if (!token) {
      const errorDiv = document.createElement("div");
      errorDiv.className = "alert alert-danger";
      errorDiv.setAttribute("role", "alert");

      const icon = document.createElement("i");
      icon.className = "bi bi-exclamation-circle";
      errorDiv.appendChild(icon);

      const space = document.createTextNode(" ");
      errorDiv.appendChild(space);

      const strong = document.createElement("strong");
      strong.textContent = "Invalid Link:";
      errorDiv.appendChild(strong);

      const message = document.createTextNode(
        " The password reset link is missing or invalid."
      );
      errorDiv.appendChild(message);

      errorAlert.appendChild(errorDiv);
      resetBtn.disabled = true;
    }

    newPasswordInput.addEventListener("input", function () {
      checkPasswordStrength(this.value);
    });

    resetPasswordForm.addEventListener("submit", async function (e) {
      e.preventDefault();

      const newPassword = document.getElementById("newPassword").value;
      const confirmPassword = document.getElementById("confirmPassword").value;

      // Validate passwords match
      if (newPassword !== confirmPassword) {
        while (errorAlert.firstChild) {
          errorAlert.removeChild(errorAlert.firstChild);
        }

        const errorDiv = document.createElement("div");
        errorDiv.className = "alert alert-danger";
        errorDiv.setAttribute("role", "alert");

        const icon = document.createElement("i");
        icon.className = "bi bi-exclamation-circle";
        errorDiv.appendChild(icon);

        const space = document.createTextNode(" ");
        errorDiv.appendChild(space);

        const message = document.createTextNode("Passwords do not match");
        errorDiv.appendChild(message);

        errorAlert.appendChild(errorDiv);
        return;
      }

      // Validate password strength
      if (newPassword.length < 8) {
        while (errorAlert.firstChild) {
          errorAlert.removeChild(errorAlert.firstChild);
        }

        const errorDiv = document.createElement("div");
        errorDiv.className = "alert alert-danger";
        errorDiv.setAttribute("role", "alert");

        const icon = document.createElement("i");
        icon.className = "bi bi-exclamation-circle";
        errorDiv.appendChild(icon);

        const message = document.createTextNode(
          " Password must be at least 8 characters long"
        );
        errorDiv.appendChild(message);

        errorAlert.appendChild(errorDiv);
        return;
      }

      resetBtn.disabled = true;
      resetBtn.classList.add("loading");

      // Clear alerts
      while (errorAlert.firstChild) {
        errorAlert.removeChild(errorAlert.firstChild);
      }
      while (successAlert.firstChild) {
        successAlert.removeChild(successAlert.firstChild);
      }

      try {
        // Call reset password API endpoint
        const formData = new FormData();
        formData.append("password", newPassword);

        const response = await fetch(
          `/api/v1/users/reset-password?token=${encodeURIComponent(token)}`,
          {
            method: "POST",
            credentials: "include",
            body: formData,
          }
        );

        const data = await response.json();

        if (!response.ok) {
          throw new Error(data.detail || "Failed to reset password");
        }

        // Show success message
        showToast("Password reset successfully!", "success");
        const successDiv = document.createElement("div");
        successDiv.className = "alert alert-success";
        successDiv.setAttribute("role", "alert");

        const icon = document.createElement("i");
        icon.className = "bi bi-check-circle";
        successDiv.appendChild(icon);

        const space = document.createTextNode(" ");
        successDiv.appendChild(space);

        const strong = document.createElement("strong");
        strong.textContent = "Success!";
        successDiv.appendChild(strong);

        const message = document.createTextNode(
          " " + (data.detail || "Your password has been reset successfully.")
        );
        successDiv.appendChild(message);

        successAlert.appendChild(successDiv);
        resetPasswordForm.reset();

        // Redirect to login after 2 seconds
        setTimeout(() => {
          window.location.href = "/login";
        }, 2000);
      } catch (error) {
        const errorDiv = document.createElement("div");
        errorDiv.className = "alert alert-danger";
        errorDiv.setAttribute("role", "alert");

        const icon = document.createElement("i");
        icon.className = "bi bi-exclamation-circle";
        errorDiv.appendChild(icon);

        const space = document.createTextNode(" ");
        errorDiv.appendChild(space);

        const strong = document.createElement("strong");
        strong.textContent = "Error:";
        errorDiv.appendChild(strong);

        const errorMessage = document.createTextNode(
          " " + (error.message || "Failed to reset password")
        );
        errorDiv.appendChild(errorMessage);

        errorAlert.appendChild(errorDiv);
        resetBtn.disabled = false;
        resetBtn.classList.remove("loading");
      }
    });

    function checkPasswordStrength(password) {
      const strengthElement = document.getElementById("passwordStrength");

      // Clear existing content
      while (strengthElement.firstChild) {
        strengthElement.removeChild(strengthElement.firstChild);
      }

      let strength = 0;

      if (password.length >= 8) strength++;
      if (/[a-z]/.test(password)) strength++;
      if (/[A-Z]/.test(password)) strength++;
      if (/\d/.test(password)) strength++;
      if (/[^a-zA-Z\d]/.test(password)) strength++;

      let label, className;
      if (strength < 2) {
        label = "ðŸ”´ Weak Password";
        className = "password-strength strength-weak";
      } else if (strength < 4) {
        label = "ðŸŸ¡ Fair Password";
        className = "password-strength strength-fair";
      } else {
        label = "ðŸŸ¢ Strong Password";
        className = "password-strength strength-good";
      }

      strengthElement.textContent = label;
      strengthElement.className = className;
    }
  });
</script>
{% endblock %}
